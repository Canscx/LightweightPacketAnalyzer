# T1.1 新建会话功能 - Align阶段文档

## 项目基本信息
- **任务名称**: T1.1 新建会话功能
- **所属任务组**: 任务组1: 会话管理功能
- **优先级**: 高
- **预估工时**: 2小时
- **创建时间**: 2024-12-19

## 原始需求分析

### 功能描述
根据功能完成任务列表，T1.1新建会话功能需要实现：
- 创建新的捕获会话
- 清空当前数据包列表和统计信息
- 重置计数器和状态

### 验收标准
- 点击"新建会话"按钮能清空界面数据
- 生成新的会话ID
- 状态栏显示新会话信息

## 现有项目架构分析

### 项目结构理解
```
LightweightPacketAnalyzer/
├── src/network_analyzer/
│   ├── gui/           # GUI相关代码
│   ├── capture/       # 数据包捕获
│   ├── processing/    # 数据处理
│   ├── storage/       # 数据存储
│   └── config/        # 配置管理
```

### 关键组件识别
1. **GUI组件**: `main_window.py` - 主界面窗口
2. **数据管理**: `DataManager` - 数据库操作
3. **会话管理**: 需要分析是否已有会话相关代码
4. **状态管理**: 界面状态和计数器管理

## 需求理解确认

### 核心功能点
1. **界面数据清空**
   - 清空数据包列表 (TreeView)
   - 重置统计信息显示
   - 清空状态栏信息

2. **会话状态重置**
   - 生成新的会话ID
   - 重置捕获计数器
   - 重置时间戳

3. **数据库操作**
   - 可能需要在数据库中创建新会话记录
   - 清理当前会话的临时数据

### 边界确认
- **包含**: 界面重置、会话ID生成、状态更新
- **不包含**: 会话保存功能（属于T1.3）、会话加载功能（属于T1.2）
- **依赖**: 需要了解现有的数据结构和界面组件

## 技术约束分析

### 现有技术栈
- **GUI框架**: tkinter
- **数据库**: SQLite
- **架构模式**: 分层架构

### 集成约束
- 必须与现有GUI组件兼容
- 不能破坏现有的数据捕获流程
- 需要保持代码风格一致性

## 疑问澄清

### 基于代码分析的发现

通过分析现有代码，发现：
- DataManager已有完整的会话管理功能（create_session, get_sessions, update_session）
- DataProcessor有reset_stats()方法可重置统计信息
- GUI主窗口有完整的界面组件需要重置

### 6.2 用户决策确认

**✅ 决策点1: 会话命名策略**
- **用户选择**: 选项B - 弹出对话框让用户输入自定义名称
- **实现方案**: 使用tkinter.simpledialog.askstring()获取用户输入的会话名称

**✅ 决策点2: 当前捕获状态处理**
- **用户选择**: 选项B - 如果正在捕获，提示用户先手动停止
- **实现方案**: 检查捕获状态，如果正在捕获则显示提示对话框，引导用户先停止捕获

**✅ 决策点3: 当前数据保存策略**
- **用户选择**: 选项B - 提示用户是否保存当前数据
- **实现方案**: 使用messagebox.askyesnocancel()询问用户是否保存当前会话数据

**✅ 决策点4: 界面重置范围**
- **用户确认**: 重置所有界面元素
- **重置范围**: 数据包列表显示（packet_tree）、统计信息显示（stats_text）、详情面板内容（detail_text）、状态栏信息（status_text）、数据包计数标签（packet_count_label）

### 待分析的代码文件
- `src/network_analyzer/gui/main_window.py` - 主界面实现
- `src/network_analyzer/storage/data_manager.py` - 数据管理
- 数据库schema - 了解现有表结构

## 风险识别

### 技术风险
- **数据一致性**: 清空界面时可能影响正在进行的捕获
- **状态同步**: 多个组件的状态需要同步重置

### 实现风险
- **界面响应**: 清空大量数据时可能造成界面卡顿
- **数据丢失**: 用户可能意外触发新建会话

## 下一步计划

1. **代码分析**: 详细分析现有GUI和数据管理代码
2. **数据库检查**: 确认sessions表结构
3. **界面组件梳理**: 识别需要重置的所有界面元素
4. **制定实现方案**: 基于分析结果设计具体实现

---

**状态**: 🔄 进行中  
**下一阶段**: Architect阶段