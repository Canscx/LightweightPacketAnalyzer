# CONSENSUS_T1.1新建会话功能

## 1. 项目基本信息
- **任务名称**: T1.1 新建会话功能
- **项目路径**: d:\项目\计算机网络课设\LightweightPacketAnalyzer
- **创建时间**: 2024-01-15
- **状态**: Align阶段完成，进入Architect阶段

## 2. 明确的需求描述

### 2.1 功能概述
实现网络数据包分析器的"新建会话"功能，允许用户创建新的数据分析会话，重置当前界面状态，开始新的数据包捕获和分析任务。

### 2.2 核心功能需求
1. **会话命名**: 弹出对话框让用户输入自定义会话名称
2. **状态检查**: 检查当前捕获状态，如正在捕获则提示用户先停止
3. **数据保存**: 提示用户是否保存当前会话数据
4. **界面重置**: 清空所有界面显示内容和统计信息
5. **会话创建**: 在数据库中创建新的会话记录

### 2.3 验收标准
- ✅ 点击"新建会话"菜单项能正确触发功能
- ✅ 如果正在捕获，显示提示对话框要求用户先停止捕获
- ✅ 弹出对话框让用户输入会话名称，支持取消操作
- ✅ 询问用户是否保存当前数据，支持是/否/取消三种选择
- ✅ 成功重置所有界面元素（数据包列表、统计信息、详情面板、状态栏）
- ✅ 在数据库中创建新的会话记录
- ✅ 重置DataProcessor的统计数据
- ✅ 更新界面状态显示新会话信息

## 3. 技术实现方案

### 3.1 技术栈约束
- **GUI框架**: tkinter (现有)
- **数据库**: SQLite (现有)
- **数据处理**: DataProcessor类 (现有)
- **数据管理**: DataManager类 (现有)

### 3.2 核心组件接口
- **MainWindow.new_session()**: 主要实现方法
- **DataManager.create_session()**: 创建数据库会话记录
- **DataProcessor.reset_stats()**: 重置统计数据
- **GUI组件**: tkinter.simpledialog, tkinter.messagebox

### 3.3 集成方案
- 修改MainWindow类的new_session方法实现
- 复用现有的DataManager和DataProcessor接口
- 使用现有的GUI组件和样式

## 4. 任务边界限制

### 4.1 功能边界
- **包含**: 新建会话的完整流程实现
- **不包含**: 会话管理界面、会话历史查看、会话导入导出
- **不包含**: 捕获功能的修改（仅检查状态）

### 4.2 技术边界
- 不修改现有数据库结构
- 不修改DataManager和DataProcessor的接口
- 不修改主窗口的整体布局

## 5. 风险评估与缓解

### 5.1 技术风险
- **低风险**: 所有需要的接口和组件都已存在
- **低风险**: 实现逻辑相对简单，主要是流程控制

### 5.2 用户体验风险
- **中等风险**: 用户可能在捕获过程中误点新建会话
- **缓解方案**: 明确的提示对话框和状态检查

## 6. 确认的设计决策

### 6.1 用户交互决策
1. **会话命名**: 使用tkinter.simpledialog.askstring()获取用户输入
2. **捕获状态处理**: 检查后提示用户手动停止，不自动停止
3. **数据保存**: 使用messagebox.askyesnocancel()三选项对话框
4. **界面重置**: 重置所有相关界面元素

### 6.2 技术实现决策
1. **错误处理**: 使用try-catch处理数据库操作异常
2. **状态管理**: 通过MainWindow的现有状态变量管理
3. **用户反馈**: 通过状态栏显示操作结果

## 7. 下一步计划
1. **Architect阶段**: 设计详细的系统架构和接口规范
2. **重点关注**: 方法调用流程、异常处理机制、用户交互流程
3. **输出文档**: DESIGN_T1.1新建会话.md

---
**文档状态**: ✅ 完成
**审核状态**: 待审核
**下一阶段**: Architect阶段