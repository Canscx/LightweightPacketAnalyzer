# 流量趋势功能 - 对齐文档 (ALIGNMENT)

## 项目上下文分析

### 现有项目架构
- **技术栈**: Python + Tkinter + SQLite + Matplotlib
- **数据基础**: 完善的数据包存储和查询系统
- **GUI框架**: 基于Tkinter的主窗口架构
- **数据管理**: DataManager提供丰富的查询接口

### 现有数据模型
```sql
-- packets表结构
CREATE TABLE packets (
    id INTEGER PRIMARY KEY,
    timestamp REAL NOT NULL,
    src_ip TEXT,
    dst_ip TEXT,
    protocol TEXT NOT NULL,
    length INTEGER NOT NULL,
    session_id INTEGER,
    ...
)
```

### 现有功能模式
- 菜单驱动的功能调用
- 独立对话框窗口展示
- 实时数据更新机制
- 统计数据可视化（已有基础）

## 原始需求分析

### 用户需求
> "还差流量趋势、生成报告还没有实现"

### 功能期望（基于课程设计要求）
1. **流量趋势可视化**: 显示网络流量随时间变化的趋势
2. **实时更新**: 捕获过程中实时更新趋势图
3. **多维度分析**: 支持数据包数量和字节流量两个维度
4. **时间窗口**: 可配置显示的时间范围

## 需求理解确认

### 核心功能定义
**流量趋势功能**应该提供：

1. **时间序列图表**
   - X轴：时间（秒/分钟为单位）
   - Y轴：流量指标（数据包数/字节数）
   - 支持双Y轴显示（包数量 + 字节流量）

2. **实时更新机制**
   - 捕获过程中自动更新图表
   - 可配置更新频率（默认1秒）
   - 滑动时间窗口（如最近5分钟）

3. **交互功能**
   - 时间范围选择
   - 图表缩放和平移
   - 数据点详情显示

4. **数据源**
   - 基于现有packets表的timestamp和length字段
   - 支持当前会话和历史会话数据
   - 可按协议类型过滤

### 技术约束
- **GUI框架**: 必须使用Tkinter，保持界面一致性
- **图表库**: 使用Matplotlib，项目已有依赖
- **数据查询**: 复用DataManager的现有接口
- **窗口模式**: 独立对话框窗口，与其他功能保持一致

### 集成方案
- **菜单入口**: 分析 → 流量趋势
- **快捷键**: Ctrl+T
- **数据同步**: 与主窗口的捕获状态同步
- **会话关联**: 支持当前会话和选择历史会话

## 边界确认

### 功能范围
✅ **包含功能**:
- 时间序列流量图表显示
- 实时数据更新
- 基础交互功能（缩放、时间范围选择）
- 数据包数量和字节流量双指标

❌ **不包含功能**:
- 复杂的统计分析（如预测、异常检测）
- 网络拓扑图
- 地理位置分析
- 深度包检测分析

### 性能边界
- **数据量**: 支持最多10万个数据包的趋势分析
- **时间范围**: 支持最长24小时的时间窗口
- **更新频率**: 最快1秒更新一次
- **内存使用**: 图表数据占用不超过50MB

## 疑问澄清

### 已解决的设计决策
1. **图表类型**: 使用折线图显示趋势，直观易读
2. **时间粒度**: 支持秒级和分钟级聚合
3. **窗口设计**: 独立对话框，可调整大小
4. **数据聚合**: 按时间间隔聚合数据包统计

### 已确认的设计决策 ✅
1. **默认时间窗口**: 显示最近5分钟的趋势 ✅
2. **协议过滤**: 支持按协议类型（TCP/UDP/ICMP/DNS）分别显示趋势线 ✅
3. **导出功能**: 趋势图支持导出为PNG图片 ✅
4. **更新频率**: 实时更新1秒频率（保持原设计）
5. **数据聚合**: 按秒级聚合显示（保持原设计）

### 设计决策影响
- **多协议支持**: 需要在数据查询层添加协议分类逻辑
- **PNG导出**: 需要集成matplotlib的savefig功能
- **DNS协议**: 需要在协议解析中识别DNS流量

## 验收标准

### 功能验收
1. ✅ 点击"流量趋势"菜单能打开趋势图窗口
2. ✅ 显示当前会话的流量时间序列图
3. ✅ 实时捕获时图表能自动更新
4. ✅ 支持时间范围选择和图表交互
5. ✅ 显示数据包数量和字节流量双指标

### 性能验收
1. ✅ 图表加载时间不超过2秒
2. ✅ 实时更新不影响主界面响应
3. ✅ 支持1000+数据包的流畅显示

### 集成验收
1. ✅ 与现有GUI风格保持一致
2. ✅ 不影响其他功能的正常使用
3. ✅ 错误处理完善，不会导致程序崩溃

---

**文档状态**: ✅ 已完成  
**下一阶段**: Architect（架构设计）  
**创建时间**: 2024-12-19  
**更新时间**: 2024-12-19